--- shadowsocksr.4	2022-12-12 02:31:56.641677651 +0800
+++ shadowsocksr.5	2022-12-12 02:42:25.991677411 +0800
@@ -41,6 +41,7 @@ redir_udp=0
 local_enable=0
 kcp_enable_flag=0
 pdnsd_enable_flag=0
+no_ipv6=$(uci get shadowsocksr.@global[0].no_ipv6)
 switch_server=$1
 CRON_FILE=/etc/crontabs/root
 EXTRA_COMMANDS='reset'
@@ -208,7 +209,7 @@ start_dns() {
 				"wan_114") chinadns="$wandns,114.114.114.114" ;;
 				esac
 
-				ln_start_bin $(first_type chinadns-ng) chinadns-ng -l $china_dns_port -4 china -p 3 -c ${chinadns/:/#} -t $dns_ip#$dns_port -N -f -r
+				ln_start_bin $(first_type chinadns-ng) chinadns-ng -l $china_dns_port -4 china -p 3 -c ${chinadns/:/#} -t $dns_ip#$dns_port $(test "$no_ipv6" -eq 1 && echo -N) -f -r
 
 				cat <<-EOF >> "$TMP_DNSMASQ_PATH/chinadns_fixed_server.conf"
 					no-poll
@@ -991,6 +992,7 @@ reset() {
 		set shadowsocksr.@global[0].adblock_url='https://anti-ad.net/anti-ad-for-dnsmasq.conf'
 		set shadowsocksr.@global[0].mydnsip='127.0.0.1'
 		set shadowsocksr.@global[0].mydnsport='5335'
+		set shadowsocksr.@global[0].no_ipv6='1'
 		add shadowsocksr server_subscribe
 		set shadowsocksr.@server_subscribe[0].proxy='0'
 		set shadowsocksr.@server_subscribe[0].auto_update_time='2'
